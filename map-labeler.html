<!DOCTYPE html>
<html>
<head>
  <title>Map Data Collector</title>
  <style>
    #map {
      position: relative;
      cursor: crosshair;
      background-image: url('sample_data/image.png');
      background-size: 300%; /* For 3x zoom */
      width: 100vw;
      height: 100vh;
      background-position: 0 0;
    }

    #popup {
      position: absolute;
      display: none;
      background: white;
      padding: 10px;
      border: 1px solid black;
    }

    .direction-btn {
      position: fixed;
      bottom: 20px;
      left: 20px;
      width: 50px;
      height: 50px;
      border-radius: 50%;
      border: #000000;
      background: #45FA11;
    }

    #up-btn {
      transform: translateY(-100px) translateX(50px);

    }

    #down-btn {
      transform: translateX(50px);
    }

    #left-btn {
      transform: translateY(-50px);
    }

    #right-btn {
      transform: translateX(100px) translateY(-50px);
    }

    #zoom-in-btn {
      position: fixed;
      bottom: 210px;
      left: 20px;
    }

    #zoom-out-btn {
      position: fixed;
      bottom: 210px;
      left: 80px;
    }

  </style>
</head>
<body>
  <div id="map"></div>

  <form id="popup" onsubmit="event.preventDefault(); saveData();">
    <label for="province-name">Province Code:</label>
    <input type="text" id="province-name"><br>

    <label for="adjacent-provinces">Adjacent Provinces:</label>
    <input type="text" id="adjacent-provinces"><br>

    <button type="submit" id="save-btn">Save</button>
  </form>

  <button id="save-json-btn" style="position: fixed; bottom: 10px; right: 10px;">Save JSON</button>

  <button id="up-btn" class="direction-btn">Up</button>
  <button id="down-btn" class="direction-btn">Down</button>
  <button id="left-btn" class="direction-btn">Left</button>
  <button id="right-btn" class="direction-btn">Right</button>

    <button id="zoom-in-btn">Zoom In</button>
  <button id="zoom-out-btn">Zoom Out</button>



  <canvas id="canvas" style="display: none;"></canvas>
</body>
<script>
let map = document.getElementById('map');
let popup = document.getElementById('popup');
let provinceNameInput = document.getElementById('province-name');
let adjacentProvincesInput = document.getElementById('adjacent-provinces');
let saveBtn = document.getElementById('save-btn');
let saveJsonBtn = document.getElementById('save-json-btn');
let upBtn = document.getElementById('up-btn');
let downBtn = document.getElementById('down-btn');
let leftBtn = document.getElementById('left-btn');
let rightBtn = document.getElementById('right-btn');
let zoomInBtn = document.getElementById('zoom-in-btn');
let zoomOutBtn = document.getElementById('zoom-out-btn');
let canvas = document.getElementById('canvas');
let context = canvas.getContext('2d');
let data = [];
let backgroundPos = [0, 0]; // Keep track of image position
let zoomLevel = 3; // Start with a 3x zoom

// When map is clicked, show popup at clicked position
map.addEventListener('click', (event) => {
  popup.style.left = `${event.pageX}px`;
  popup.style.top = `${event.pageY}px`;
  popup.style.display = 'block';

  // Store click position
  popup.clickX = event.pageX;
  popup.clickY = event.pageY;
});

// Function to store data
function saveData() {
  // Get pixel color at clicked position
  let img = new Image();
  img.src = 'sample_data/image.png';
  img.onload = function () {
    canvas.width = img.width;
    canvas.height = img.height;
    context.drawImage(img, 0, 0, img.width, img.height);

    let pixel = context.getImageData(popup.clickX, popup.clickY, 1, 1).data;
    let color = `rgb(${pixel[0]}, ${pixel[1]}, ${pixel[2]})`;

    // Store data
    data.push({
      name: provinceNameInput.value,
      adjacentProvinces: adjacentProvincesInput.value.split(',').map(s => s.trim()),
      coordinates: [popup.clickX, popup.clickY],
      color: color
    });

    // Clear inputs
    provinceNameInput.value = '';
    adjacentProvincesInput.value = '';

    // Hide popup
    popup.style.display = 'none';
  };
}

// Save data to JSON file when "Save JSON" button is clicked
saveJsonBtn.addEventListener('click', () => {
  let a = document.createElement('a');
  a.href = URL.createObjectURL(new Blob([JSON.stringify(data)], {type: 'application/json'}));
  a.download = 'data.json';
  a.click();
});

// Function to move the image
function moveImage(dx, dy) {
  backgroundPos[0] += dx;
  backgroundPos[1] += dy;
  map.style.backgroundPosition = `${backgroundPos[0]}px ${backgroundPos[1]}px`;
}


// Attach moveImage to directional buttons
upBtn.addEventListener('click', () => moveImage(0, 500));
downBtn.addEventListener('click', () => moveImage(0, -500));
leftBtn.addEventListener('click', () => moveImage(500, 0));
rightBtn.addEventListener('click', () => moveImage(-500, 0));
// Function to zoom the image
function zoomImage(zoomChange) {
  zoomLevel += zoomChange;
  map.style.backgroundSize = `${zoomLevel * 100}%`;
}

// Attach zoomImage to zoom buttons
zoomInBtn.addEventListener('click', () => zoomImage(0.3));
zoomOutBtn.addEventListener('click', () => zoomImage(-0.3));

</script>
</html>
